# 2025-07-15 变更日志

## 系统优化和Bug修复

### 1. 项目结构修复
**问题**: 主目录包含错误的依赖管理文件
- 删除了主目录下的错误 `package.json`、`pnpm-lock.yaml` 和 `node_modules`
- 确保所有前端依赖都在 `frontend/` 目录下正确管理
- 重新安装依赖，解决了 Pinia 状态管理依赖问题

### 2. 认证状态持久化修复
**问题**: 页面刷新后自动退出登录
- 修改 `initializeAuth` 方法，在开发模式下跳过API验证
- 更新请求拦截器，开发模式下不自动清除token
- 增强开发模式的控制台日志，便于调试

### 3. 构建错误修复
**问题**: 缺少组件导致构建失败
- 创建了完整的 `UserForm.vue` 组件，支持用户CRUD操作
- 修复了 `Teacher.vue` 中对不存在组件的引用

### 4. 管理员权限系统修复
**问题**: 管理员导航栏只显示"控制面板"
- 增强 `dev.ts` 中的 `mockLogin` 函数，返回完整的权限数据
- 修复权限系统中的通配符支持（`resource:*`）
- 确保管理员能访问所有功能模块

### 5. 用户管理和教师管理整合
**问题**: 教师管理和用户管理功能重复
- 删除独立的 `Teacher.vue` 页面，避免功能重复
- 重新设计 `User.vue` 页面，采用分页签方式组织用户管理
- 新增分页签：全部用户、管理员、教师、学生
- 增强 `UserForm.vue` 组件，支持教师角色的特殊字段：
  - 工号（teacherId）
  - 学科（subject）
  - 学历（education）
  - 职称（title）
- 更新路由配置，移除教师管理路由
- 优化用户界面，根据不同分页签显示相应的列和操作

### 6. 表单验证增强
- 为教师工号添加格式验证（T+3-6位数字）
- 添加学科选择验证
- 根据角色动态调整表单验证规则

### 7. Vue 3 组件属性修复
**问题**: 弹窗组件的 v-model 绑定错误
- 修复 `UserProfileModal.vue` 中的 `v-model:open="visible"` 问题
- 修复 `AccountSettingsModal.vue` 中的 `v-model:open="visible"` 问题  
- 修复 `ChangePasswordModal.vue` 中的 `v-model:open="visible"` 问题
- 将 `v-model:open="visible"` 改为 `:open="visible"` 和 `@update:open` 事件监听器
- 确保弹窗组件能够正确接收 prop 并触发事件

## 技术改进

### 用户管理页面重构
- 采用分页签设计，统一管理所有用户类型
- 智能搜索：支持按姓名、手机号、工号搜索
- 角色特定显示：教师分页签显示工号和学科，其他分页签显示手机号
- 统计卡片：显示各类用户数量统计
- 批量操作：支持导出、状态切换、密码重置等

### 组件复用优化
- `UserForm.vue` 支持多角色用户创建和编辑
- 根据角色动态显示相应字段
- 智能表单验证和数据提交

## 文件变更

### 删除的文件
- `frontend/src/views/Teacher.vue` - 整合到用户管理中

### 修改的文件
- `frontend/src/views/User.vue` - 重构为分页签式用户管理
- `frontend/src/components/UserForm.vue` - 增强支持教师角色字段
- `frontend/src/router/index.ts` - 移除教师管理路由
- `frontend/src/utils/dev.ts` - 修复权限数据返回

### 新增功能
- 统一的用户管理界面
- 角色特定的表单字段
- 智能搜索和过滤
- 用户统计展示

### 7. 导航栏清理
**问题**: 删除教师管理页面后，导航栏仍显示教师管理菜单项
- 从 `BaseLayout.vue` 中移除教师管理菜单项配置
- 确保导航栏只显示有效的功能模块
- 验证构建成功，无错误提示

## 用户界面完善（2025-07-15 下午更新）

### 8. 用户个人中心功能完善
**问题**: 用户头像下拉菜单功能不完整
- 创建了 `UserProfileModal.vue` 组件，支持个人资料查看和编辑
- 创建了 `AccountSettingsModal.vue` 组件，提供账户设置功能：
  - 基本设置：语言、时区、主题、自动登录
  - 通知设置：系统通知、邮件通知、短信通知、桌面通知
  - 隐私设置：个人信息可见性、活动记录、数据统计
  - 高级设置：开发者模式、实验性功能、缓存管理、数据导出
- 创建了 `ChangePasswordModal.vue` 组件，支持密码修改功能：
  - 密码强度实时检测
  - 密码安全要求提示
  - 修改后自动退出重新登录
- 集成所有弹窗组件到 `BaseLayout.vue` 中

### 9. 独立报名登记页面
**问题**: 用户反馈报名功能需要独立页面
- 创建了独立的 `Registration.vue` 报名登记页面
- 采用分步骤表单设计，包含三个步骤：
  1. 基本信息：姓名、性别、出生日期、民族、文化程度、政治面貌、身份证号、健康状况
  2. 学籍信息：是否在职、保险类别、所报专业、保险有效期、学员证号、超龄协议
  3. 联系信息：家庭住址、联系电话、紧急联系人、个人照片、备注
- 添加进度指示器，显示当前步骤和完成状态
- 支持照片上传功能
- 添加表单验证和身份证号重复检查
- 增加路由配置 `/registration`
- 在侧边栏菜单中添加"报名登记"导航项

### 10. 用户体验优化
- 所有弹窗组件采用现代化设计，圆角边框和阴影效果
- 报名页面采用渐变背景和步骤动画
- 密码修改组件增加密码强度可视化指标
- 账户设置提供丰富的配置选项和说明文字
- 表单验证提供友好的错误提示

## 文件变更

### 新增的文件
- `frontend/src/components/UserProfileModal.vue` - 个人资料弹窗
- `frontend/src/components/AccountSettingsModal.vue` - 账户设置弹窗
- `frontend/src/components/ChangePasswordModal.vue` - 修改密码弹窗
- `frontend/src/views/Registration.vue` - 独立报名登记页面

### 修改的文件
- `frontend/src/components/BaseLayout.vue` - 集成弹窗组件，增加报名登记菜单
- `frontend/src/router/index.ts` - 添加报名登记路由

### 新增功能
- 完整的用户个人中心功能
- 独立的报名登记页面
- 分步骤表单设计
- 密码强度检测
- 账户设置管理
- 照片上传功能

## 下一步计划
- 优化用户管理的分页功能
- 添加用户批量操作功能
- 完善教师特殊字段的业务逻辑
- 考虑添加用户导入导出功能
- 完善报名审核流程
- 优化移动端适配 