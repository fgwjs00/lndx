# ğŸ› ï¸ å®å¡”é¢æ¿å›¾ç‰‡ä¸Šä¼ é—®é¢˜è§£å†³æŒ‡å—

## ğŸ“‹ é—®é¢˜ç°è±¡
- å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼ˆåç«¯è¿”å›200çŠ¶æ€ï¼‰
- ä½†æ˜¯å›¾ç‰‡æ— æ³•é€šè¿‡URLè®¿é—®æ˜¾ç¤º
- å‰ç«¯æ˜¾ç¤ºå›¾ç‰‡åŠ è½½å¤±è´¥

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### 1. **æ£€æŸ¥å’Œåˆ›å»ºä¸Šä¼ ç›®å½•**

ç™»å½•æœåŠ¡å™¨ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
ls -la /www/wwwroot/lndx/backend/uploads/

# å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½•
mkdir -p /www/wwwroot/lndx/backend/uploads/id-cards

# è®¾ç½®æ­£ç¡®çš„æƒé™
chmod 755 /www/wwwroot/lndx/backend/uploads/
chmod 755 /www/wwwroot/lndx/backend/uploads/id-cards/
chown -R www:www /www/wwwroot/lndx/backend/uploads/
```

### 2. **é…ç½®Nginxé™æ€æ–‡ä»¶æœåŠ¡**

åœ¨å®å¡”é¢æ¿ä¸­ï¼š

#### æ­¥éª¤1ï¼šæ‰“å¼€ç½‘ç«™è®¾ç½®
1. ç™»å½•å®å¡”é¢æ¿
2. ç‚¹å‡»ã€Œç½‘ç«™ã€
3. æ‰¾åˆ°æ‚¨çš„åŸŸåï¼ˆå¦‚ï¼šln.tuojiayi.comï¼‰
4. ç‚¹å‡»ã€Œè®¾ç½®ã€

#### æ­¥éª¤2ï¼šä¿®æ”¹Nginxé…ç½®
1. ç‚¹å‡»ã€Œé…ç½®æ–‡ä»¶ã€æ ‡ç­¾
2. åœ¨serverå—ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```nginx
# åœ¨ server { å—å†…æ·»åŠ ï¼š

# é™æ€æ–‡ä»¶æœåŠ¡é…ç½®
location /uploads/ {
    alias /www/wwwroot/lndx/backend/uploads/;
    expires 1y;
    add_header Cache-Control "public, immutable";
    access_log off;
    autoindex off;
    
    # æ”¯æŒå›¾ç‰‡æ ¼å¼
    location ~* \.(jpg|jpeg|png|gif|ico|svg|webp)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

#### æ­¥éª¤3ï¼šé‡è½½Nginx
```bash
# æµ‹è¯•é…ç½®
nginx -t

# é‡è½½é…ç½®
nginx -s reload
```

### 3. **æ£€æŸ¥é˜²ç«å¢™å’Œå®‰å…¨ç»„**

ç¡®ä¿ä»¥ä¸‹ç«¯å£å¼€æ”¾ï¼š
- 80 (HTTP)
- 443 (HTTPS)
- 3000 (åç«¯APIï¼Œå¦‚æœç›´æ¥è®¿é—®)

### 4. **éªŒè¯é…ç½®**

#### æµ‹è¯•1ï¼šæ‰‹åŠ¨åˆ›å»ºæµ‹è¯•æ–‡ä»¶
```bash
# åˆ›å»ºæµ‹è¯•å›¾ç‰‡æ–‡ä»¶
echo "test image" > /www/wwwroot/lndx/backend/uploads/id-cards/test.jpg

# æµ‹è¯•è®¿é—®
curl -I http://ln.tuojiayi.com/uploads/id-cards/test.jpg
```

#### æµ‹è¯•2ï¼šæ£€æŸ¥å®é™…ä¸Šä¼ çš„æ–‡ä»¶
```bash
# æŸ¥çœ‹æœ€æ–°ä¸Šä¼ çš„æ–‡ä»¶
ls -la /www/wwwroot/lndx/backend/uploads/id-cards/ | tail -5

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /www/wwwroot/lndx/backend/uploads/id-cards/idcard_*.jpg
```

### 5. **å¸¸è§é—®é¢˜æ’æŸ¥**

#### é—®é¢˜1ï¼š403 Forbidden
```bash
# æ£€æŸ¥SELinuxï¼ˆå¦‚æœå¯ç”¨ï¼‰
sestatus
# å¦‚æœå¯ç”¨ï¼Œå¯èƒ½éœ€è¦è®¾ç½®ä¸Šä¸‹æ–‡
```

#### é—®é¢˜2ï¼š404 Not Found  
- æ£€æŸ¥Nginxé…ç½®ä¸­çš„aliasè·¯å¾„æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥locationåŒ¹é…è§„åˆ™

#### é—®é¢˜3ï¼šæƒé™é—®é¢˜
```bash
# é‡ç½®æƒé™
chown -R www:www /www/wwwroot/lndx/backend/uploads/
chmod -R 755 /www/wwwroot/lndx/backend/uploads/
```

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### 1. ä¸Šä¼ æµ‹è¯•
1. å‰ç«¯å°è¯•ä¸Šä¼ å›¾ç‰‡
2. æ£€æŸ¥æµè§ˆå™¨Networkæ ‡ç­¾é¡µï¼Œç¡®è®¤è¿”å›çš„URL
3. ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®è¯¥URL

### 2. åç«¯æ—¥å¿—æ£€æŸ¥
```bash
# æŸ¥çœ‹PM2æ—¥å¿—
pm2 logs backend --lines 20

# æŸ¥çœ‹Nginxè®¿é—®æ—¥å¿—
tail -f /www/wwwlogs/ln.tuojiayi.com.log

# æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/ln.tuojiayi.com.error.log
```

### 3. ç³»ç»Ÿèµ„æºæ£€æŸ¥
```bash
# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -m

# æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
pm2 status
```

## ğŸ“ å¦‚æœä»æœ‰é—®é¢˜

æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. æµè§ˆå™¨æ§åˆ¶å°çš„å®Œæ•´é”™è¯¯ä¿¡æ¯
2. PM2æ—¥å¿—ï¼š`pm2 logs backend --lines 50`
3. Nginxé”™è¯¯æ—¥å¿—ï¼š`tail -20 /www/wwwlogs/åŸŸå.error.log`
4. ä¸Šä¼ ç›®å½•æƒé™ï¼š`ls -la /www/wwwroot/lndx/backend/uploads/`
